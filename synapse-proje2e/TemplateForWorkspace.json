{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "synapse-proje2e"
		},
		"synapse-proje2e-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'synapse-proje2e-WorkspaceDefaultSqlServer'",
			"defaultValue": "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=tcp:synapse-proje2e.sql.azuresynapse.net,1433;Initial Catalog=@{linkedService().DBName}"
		},
		"synapse-proje2e-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://proje2e.dfs.core.windows.net"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/Parquet1')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "synapse-proje2e-WorkspaceDefaultStorage",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"folderPath": "sales/delta/",
						"fileSystem": "gold-partnersales"
					},
					"compressionCodec": "snappy"
				},
				"schema": [
					{
						"name": "brand",
						"type": "UTF8"
					},
					{
						"name": "brand_uk",
						"type": "INT_64"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/synapse-proje2e-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/synapse-proje2e-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('synapse-proje2e-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/synapse-proje2e-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('synapse-proje2e-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 1')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "-- Create the user 'user1' with a password\nCREATE LOGIN user1 WITH PASSWORD = '2024mayuriSaikia!';\nGO\n\n-- Create the user in the current database (e.g., your database name)\nUSE dblicensesales;\nGO\n\nCREATE USER user1 FOR LOGIN user1;\nGO\n\n-- Grant read access to the user\nALTER ROLE db_datareader ADD MEMBER user1;\nGO\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "dblicensesales",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 2')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "-- This is auto-generated code\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_date/',\n        FORMAT = 'DELTA'\n    ) AS [result]\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script create views')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "-- creating views based on delta tables in adls gold container\n\n\n--- creating dimension tables views\ncreate view vw_dim_sentiment\nas\nSELECT sentiment_id, sentiment\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_sentiment/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\ncreate view vw_dim_brand\nas\nSELECT brand_uk, brand\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_brand/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\ncreate view vw_dim_job_role\nas\nSELECT job_role_id, job_role\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_job_role/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\ncreate view vw_dim_license_type\nas\nSELECT license_type_id, license as license_type\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_license/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\n\ncreate view vw_dim_date\nas\nSELECT date, year, month, \nDATENAME(MONTH, date) AS MonthName,\nquarter, day_in_month\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_date/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\ncreate view vw_dim_certification\nas\nSELECT certification_uk, certification_id, certification_name, brand_uk, latest_version, last_copied\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_certification/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\n\ncreate view vw_dim_partner\nas\nSELECT partner_company_id, partner_company,partner_id, partner_first_name, partner_last_name, tgt_job_role, multiple_cert_holder, location_id\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_partner/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\ncreate view vw_dim_ise\nas\nSELECT ise_id, ise as industry_solution_experience\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_ise/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\ncreate view vw_dim_ipe\nas\nSELECT ipe_id, ipe as industry_process_experience\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_ipe/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\ncreate view vw_dim_industry\nas\nSELECT industry_id, industry\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_industry/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\ncreate view vw_dim_location\nas\nSELECT location_id, region, country, state \nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_location/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\ncreate view vw_dim_license\nas\nSELECT license_id as license_type_id,  license_type\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_dim_license/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\n--- create fact table views\n\n\ncreate view dbo.vw_fact_certificationpassdatelatest\nas\nSELECT brand_uk,partner_id, ise_id, ipe_id, industry_id, certification_uk, pass_date, last_copied\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_fact_certificationpassdatelatest/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\ncreate view vw_fact_sales\nas\nSELECT uk_id, partner_company_id, partner_id, certification_uk, ise_id, ipe_id, year_name, \ncase month\n    when 'Jan' then 'January'\n    when 'Feb' then 'February'\n    when 'Mar' then 'March'\n    when 'Apr' then 'April'\n    when 'May' then 'May'\n    when 'Jun' then 'June'\n    when 'Jul' then 'July'\n    when 'Aug' then 'August'\n    when 'Sep' then 'September'\n    when 'Oct' then 'October'\n    when 'Nov' then 'November'\n    when 'Dec' then 'December'\n    else month\nEND AS MonthName,\nlicense_id as license_type_id, sales, last_copied\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_fact_sales/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\nCREATE view vw_fact_newssentiment\nas\nselect location_id, industry_id, year_name, \ncase month\n    when 'Jan' then 'January'\n    when 'Feb' then 'February'\n    when 'Mar' then 'March'\n    when 'Apr' then 'April'\n    when 'May' then 'May'\n    when 'Jun' then 'June'\n    when 'Jul' then 'July'\n    when 'Aug' then 'August'\n    when 'Sep' then 'September'\n    when 'Oct' then 'October'\n    when 'Nov' then 'November'\n    when 'Dec' then 'December'\n    else month\nEND AS MonthName,\nsentiment_id, last_copied\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_fact_newssentiment/',\n        FORMAT = 'DELTA'\n    ) as [result];\n\n\n\ncreate view vw_partnerlicense_salesrecords\nas\nSELECT a.uk_id, a.partner_company_id, a.partner_id, a.certification_uk, b.brand_uk, b.industry_id, a.ise_id, a.ipe_id, b.pass_date, a.year_name, \ncase a.month\n    when 'Jan' then 'January'\n    when 'Feb' then 'February'\n    when 'Mar' then 'March'\n    when 'Apr' then 'April'\n    when 'May' then 'May'\n    when 'Jun' then 'June'\n    when 'Jul' then 'July'\n    when 'Aug' then 'August'\n    when 'Sep' then 'September'\n    when 'Oct' then 'October'\n    when 'Nov' then 'November'\n    when 'Dec' then 'December'\n    else month\nEND AS MonthName,\na.license_id as license_type_id, a.sales, a.last_copied\nFROM\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_fact_sales/',\n        FORMAT = 'DELTA'\n    ) as a\nJOIN\n    OPENROWSET(\n        BULK 'https://proje2e.dfs.core.windows.net/gold-partnersales/sales/delta/gold_fact_certificationpassdatelatest/',\n        FORMAT = 'DELTA'\n    ) as b\n\nON a.partner_id = b.partner_id AND\n    a.certification_uk = b.certification_uk AND\n    a.ise_id = b.ise_id AND\n    a.ipe_id = b.ipe_id\n;",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "dblicensesales",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		}
	]
}